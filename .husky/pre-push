#!/bin/sh

echo "ğŸ” Running pre-push checks..."

# Debug functions check
if git diff origin/$(git rev-parse --abbrev-ref HEAD) --name-only | grep '\.php$' | xargs grep -En '\b(dd|dump|ds|ray)\(' 2>/dev/null; then
  echo "âŒ Debug functions found"
  exit 1
fi

# PHPStan
echo "ğŸ” Running PHPStan..."
docker compose exec -T app vendor/bin/phpstan analyse --memory-limit=2G || exit 1

# Frontend lint
echo "ğŸ” Linting frontend..."
npm run lint || exit 1

echo "âœ… All checks passed"